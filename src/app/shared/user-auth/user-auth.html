@if (loading()) {
  <button type="button" class="btn btn-ghost" disabled aria-busy="true">Loading...</button>
} @else if (!isAuthed()) {
  <button
    type="button"
    class="btn btn-secondary auth-btn"
    (click)="signIn()"
    aria-label="Sign in with Google"
    [disabled]="signingIn()"
    [attr.aria-busy]="signingIn()"
  >
    @if (signingIn()) {
      <span class="btn__spinner" aria-hidden="true"></span>
      <span>Signing inâ€¦</span>
    } @else {
      <img ngSrc="/assets/logos/google-logo.svg" width="18" height="18" alt="" />
      <span>Sign in with Google</span>
    }
  </button>
} @else {
  <div class="auth" role="group">
    <button
      type="button"
      class="avatar-btn"
      (click)="toggleMenu()"
      [attr.aria-expanded]="menuOpen()"
      aria-haspopup="menu"
      [title]="displayName() || 'Account'"
    >
      @if (photoUrl()) {
        <img [src]="photoUrl()!" alt="User avatar" class="avatar" />
      } @else {
        <span class="avatar avatar--initials" aria-hidden="true">{{ initials() }}</span>
      }
    </button>

    <button
      type="button"
      class="caret-btn"
      (click)="toggleMenu()"
      [attr.aria-expanded]="menuOpen()"
      aria-haspopup="menu"
      aria-label="Toggle account menu"
      title="Toggle account menu"
    >
      <svg class="caret-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    @if (menuOpen()) {
      <div class="menu" role="menu">
        <div class="menu__header">
          @if (displayName()) { <div class="menu__name text-sm fw-semibold">{{ displayName() }}</div> }
          @if (user()?.email) { <div class="menu__email text-xs text-muted">{{ user()!.email }}</div> }
        </div>
        <button type="button" class="menu__item" role="menuitem" (click)="signOut()">Sign out</button>
      </div>
    }
  </div>
}
